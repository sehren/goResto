{"version":3,"file":"super-tabs-pan-gesture.js","sourceRoot":"","sources":["../src/super-tabs-pan-gesture.ts"],"names":[],"mappings":"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","sourcesContent":["import { Platform } from 'ionic-angular';\r\nimport { pointerCoord, PointerCoordinates } from 'ionic-angular/util/dom';\r\nimport { SuperTabsConfig } from './components/super-tabs';\r\nimport { Renderer2 } from '@angular/core';\r\n\r\nexport class SuperTabsPanGesture {\r\n\r\n  onMove: (delta: number) => void;\r\n\r\n  onEnd: (shortSwipe: boolean, shortSwipeDelta?: number) => void;\r\n\r\n  private initialCoords: PointerCoordinates;\r\n\r\n  private initialTimestamp: number;\r\n\r\n  private leftThreshold: number = 0;\r\n\r\n  private rightThreshold: number = 0;\r\n\r\n  private shouldCapture: boolean;\r\n\r\n  private isDragging: boolean;\r\n\r\n  private lastPosX: number;\r\n\r\n  private listeners: Function[] = [];\r\n\r\n  constructor(\r\n    private plt: Platform,\r\n    private el: HTMLElement,\r\n    private config: SuperTabsConfig,\r\n    private rnd: Renderer2\r\n  ) {\r\n\r\n    this.listeners.push(\r\n      rnd.listen(el, 'touchstart', this._onStart.bind(this)),\r\n      rnd.listen(el, 'touchmove', this._onMove.bind(this)),\r\n      rnd.listen(el, 'touchend', this._onEnd.bind(this))\r\n    );\r\n\r\n    if (config.sideMenu === 'both' || config.sideMenu === 'left') {\r\n      this.leftThreshold = config.sideMenuThreshold;\r\n    }\r\n\r\n    if (config.sideMenu === 'both' || config.sideMenu === 'right') {\r\n      this.rightThreshold = config.sideMenuThreshold;\r\n    }\r\n\r\n  }\r\n\r\n  destroy() {\r\n    this.listeners.forEach(fn => fn());\r\n  }\r\n\r\n  private _onStart(ev: TouchEvent) {\r\n    const coords: PointerCoordinates = pointerCoord(ev),\r\n      vw = this.plt.width();\r\n\r\n    if (coords.x < this.leftThreshold || coords.x > vw - this.rightThreshold) {\r\n      // ignore this gesture, it started in the side menu touch zone\r\n      this.shouldCapture = false;\r\n      return;\r\n    }\r\n\r\n    // the starting point looks good, let's see what happens when we move\r\n\r\n    this.initialCoords = coords;\r\n    if (this.config.shortSwipeDuration > 0) this.initialTimestamp = Date.now();\r\n    this.lastPosX = coords.x;\r\n\r\n  }\r\n\r\n  private _onMove(ev: TouchEvent) {\r\n\r\n    const coords: PointerCoordinates = pointerCoord(ev);\r\n\r\n    if (!this.isDragging) {\r\n\r\n      if (typeof this.shouldCapture !== 'boolean')\r\n      // we haven't decided yet if we want to capture this gesture\r\n        this.checkGesture(coords);\r\n\r\n\r\n      if (this.shouldCapture === true)\r\n      // gesture is good, let's capture all next onTouchMove events\r\n        this.isDragging = true;\r\n      else\r\n        return;\r\n\r\n    }\r\n\r\n    // stop anything else from capturing these events, to make sure the content doesn't slide\r\n    ev.stopPropagation();\r\n    ev.preventDefault();\r\n\r\n    // get delta X\r\n    const deltaX: number = this.lastPosX - coords.x;\r\n\r\n    // emit value\r\n    this.onMove && this.onMove(deltaX);\r\n\r\n    // update last X value\r\n    this.lastPosX = coords.x;\r\n\r\n  }\r\n\r\n  private _onEnd(ev: TouchEvent) {\r\n    const coords: PointerCoordinates = pointerCoord(ev);\r\n\r\n    if (this.shouldCapture === true) {\r\n\r\n      if (this.config.shortSwipeDuration > 0) {\r\n\r\n        const deltaTime: number = Date.now() - this.initialTimestamp;\r\n\r\n        if (deltaTime <= this.config.shortSwipeDuration)\r\n          this.onEnd && this.onEnd(true, coords.x - this.initialCoords.x);\r\n        else this.onEnd && this.onEnd(false);\r\n\r\n      } else this.onEnd && this.onEnd(false);\r\n\r\n    }\r\n\r\n    this.isDragging = false;\r\n    this.shouldCapture = undefined;\r\n\r\n  }\r\n\r\n  private checkGesture(newCoords: PointerCoordinates) {\r\n\r\n    const radians = this.config.maxDragAngle * (Math.PI / 180),\r\n      maxCosine = Math.cos(radians),\r\n      deltaX = newCoords.x - this.initialCoords.x,\r\n      deltaY = newCoords.y - this.initialCoords.y,\r\n      distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\r\n\r\n    if (distance >= this.config.dragThreshold) {\r\n      // swipe is long enough so far\r\n      // lets check the angle\r\n      const angle = Math.atan2(deltaY, deltaX),\r\n        cosine = Math.cos(angle);\r\n\r\n      this.shouldCapture = Math.abs(cosine) > maxCosine;\r\n    }\r\n\r\n  }\r\n\r\n}\r\n"]}